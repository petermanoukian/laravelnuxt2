import{L as a,k as s,l as i,M as n}from"./BkfL23Qh.js";const u=a("auth",{state:()=>({user:null,token:null,loginError:null,regError:null,regSuccess:null}),getters:{isAuthenticated:r=>!!r.user&&!!r.token},actions:{async login(r){try{const{$api:e}=s(),t=i().public.apiBaseUrl,{data:o}=await e.post(`${t}/login`,r);o.user!=""?(this.user=o.user,this.token=o.access_token,localStorage.setItem("token",o.access_token),console.log("token in :",this.token),await n().push("/admin"),this.loginError=""):this.loginError="Login failed. Please check your credentials and try again."}catch(e){e.response&&e.response.status===401?this.loginError="Login failed. Please check your credentials and try again.":this.loginError="An error occurred. Please try again later.",console.error("Error logging in:",e)}},async register(r){try{const{$api:e}=s(),t=i().public.apiBaseUrl,{data:o}=await e.post(`${t}/register`,r,{headers:{"Content-Type":"multipart/form-data"}});this.regSuccess="user Added",this.regError="",console.log("token in :",this.token)}catch(e){e.response&&e.response.status===422?this.regError="Error "+e.response.data.message:this.regError="An unexpected error occurred.",this.regSuccess="",console.error("Error registering:",e)}},async logout(){try{const{$api:r}=s(),e=i().public.apiBaseUrl;await r.post(`${e}/logout`),this.user=null,this.token=null,localStorage.removeItem("token"),await n().push("/login")}catch(r){console.error("Error logging out:",r)}},async fetchUser(){try{const{$api:r}=s(),e=i().public.apiBaseUrl,{data:t}=await r.get(`${e}/user`);this.user=t,t?console.log("Fetched user:",t):await n().push("/login")}catch(r){console.error("Error fetching user:",r)}},resetRegistrationState(){setTimeout(()=>{this.regError="",this.regSuccess="",console.log("State reset")},3e3)},initialize(){this.token=localStorage.getItem("token")||null}}});export{u};
